<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>BIM Viewer Pro</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; font-family: 'Inter', sans-serif; background: #ffffff; }
        canvas { width: 100vw; height: 100vh; display: block; }
        
        #menu {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px);
            padding: 20px; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 100; width: 220px; border: 1px solid #eee;
        }

        h3 { margin: 0 0 12px 0; font-size: 11px; color: #999; text-transform: uppercase; letter-spacing: 1px; }
        
        button {
            width: 100%; margin-bottom: 6px; padding: 10px;
            border: 1px solid #ddd; border-radius: 8px;
            background: white; cursor: pointer; transition: 0.2s;
            font-size: 13px; font-weight: 500; text-align: left;
        }
        button.active { background: #000; color: #fff; border-color: #000; }
        
        .slider-label { font-size: 11px; color: #666; display: block; margin-top: 15px; margin-bottom: 5px; }
        input[type="range"] { width: 100%; accent-color: #000; cursor: pointer; }
    </style>
</head>
<body>

<div id="menu">
    <h3>Style Visuel</h3>
    <button id="btnMono" class="active" onclick="updateStyle('mono')">âšª Maquette Blanche</button>
    <button id="btnReal" onclick="updateStyle('real')">ðŸŽ¨ Rendu RÃ©aliste</button>

    <h3>Coupe BIM (Axe Y)</h3>
    <span class="slider-label">Ajuster la hauteur de coupe</span>
    <input type="range" id="clipY" min="-30" max="30" value="30" step="0.1">
    
    <div style="font-size: 10px; color: #bbb; margin-top: 20px; line-height: 1.4;">
        <b>SOURIS :</b><br>
        Clic Gauche : Orbite<br>
        Clic Droit : Pan (DÃ©placer)<br>
        Molette : Zoom
    </div>
</div>

<canvas id="myCanvas"></canvas>

<script type="module">
    // Importation des modules depuis le CDN officiel du SDK
    import {Viewer, GLTFLoaderPlugin, SectionPlanesPlugin} from "https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/xeokit-sdk.es.min.js";

    // 1. Initialisation du Viewer
    const viewer = new Viewer({
        canvasId: "myCanvas",
        transparent: false,
        backgroundColor: [1, 1, 1] // Fond blanc
    });

    // Configuration de l'Occlusion Ambiante (SAO) pour le relief
    const sao = viewer.scene.sao;
    sao.enabled = true;
    sao.intensity = 0.8;
    sao.radius = 0.3;
    sao.layers = 100;

    // 2. Activation des Plugins
    const loader = new GLTFLoaderPlugin(viewer);
    const sections = new SectionPlanesPlugin(viewer);

    // 3. Chargement du modÃ¨le projet1.glb
    const model = loader.load({
        id: "myModel",
        src: "./projet1.glb",
        edges: true, // Active les contours noirs (Rhino style)
        saoEnabled: true
    });

    // Centrer la camÃ©ra une fois chargÃ©
    model.on("loaded", () => {
        viewer.cameraFlight.jumpTo(model);
        window.updateStyle('mono'); // Style par dÃ©faut
    });

    // 4. SystÃ¨me de Coupe SectionPlane
    const planeY = sections.createSectionPlane({
        id: "clipPlane",
        pos: [0, 30, 0],   // Position initiale haute
        dir: [0, -1, 0]    // Coupe vers le bas
    });

    document.getElementById("clipY").oninput = (e) => {
        const val = parseFloat(e.target.value);
        planeY.pos = [0, val, 0];
    };

    // 5. Gestion des Styles (Maquette vs RÃ©aliste)
    window.updateStyle = (mode) => {
        const allIds = viewer.scene.objectIds;
        const btns = document.querySelectorAll('button');
        btns.forEach(b => b.classList.remove('active'));

        if (mode === 'mono') {
            document.getElementById('btnMono').classList.add('active');
            
            // Applique le blanc et les bords noirs
            viewer.scene.setObjectsColor(allIds, [0.95, 0.95, 0.95]); // Gris trÃ¨s clair / blanc
            viewer.scene.edgeMaterial.edges = true;
            viewer.scene.edgeMaterial.edgeColor = [0.1, 0.1, 0.1]; // Contours noirs
            viewer.scene.edgeMaterial.edgeWidth = 1.2;
        } 
        else {
            document.getElementById('btnReal').classList.add('active');
            
            // Restaure les textures et cache les bords noirs
            viewer.scene.setObjectsColor(allIds, null);
            viewer.scene.edgeMaterial.edges = false;
        }
    };

</script>
</body>
</html>
