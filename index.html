<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Visualiseur Architecture Pro</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #ffffff; }
        canvas { width: 100vw; height: 100vh; display: block; }
        
        /* Panneau de contr√¥le */
        #menu {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 100; width: 240px;
            border: 1px solid #eee;
        }

        h3 { margin: 0 0 15px 0; font-size: 14px; color: #333; text-transform: uppercase; letter-spacing: 1px; }
        
        .section { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .section:last-child { border-bottom: none; }

        button {
            width: 100%; margin-bottom: 8px; padding: 10px;
            border: 1px solid #ddd; border-radius: 6px;
            background: white; cursor: pointer; transition: all 0.2s;
            font-size: 13px; font-weight: 500; text-align: left;
        }
        button:hover { background: #f8f8f8; border-color: #bbb; }
        button.active { background: #000; color: #fff; border-color: #000; }
        
        label { font-size: 12px; color: #666; display: block; margin-bottom: 5px; }
        input[type="range"] { width: 100%; margin-bottom: 10px; accent-color: #000; }
        
        .reset-btn { background: #ff4757; color: white; border: none; text-align: center; }
        .reset-btn:hover { background: #ff6b81; }
    </style>
</head>
<body>

<div id="menu">
    <div class="section">
        <h3>üè† Modes de Rendu</h3>
        <button id="btnMono" class="active" onclick="setMode('mono')">‚ö™ Maquette Blanche</button>
        <button id="btnReal" onclick="setMode('real')">üé® Rendu R√©aliste</button>
        <button id="btnWire" onclick="setMode('wire')">üï∏Ô∏è Vue Filaire</button>
    </div>

    <div class="section">
        <h3>‚úÇÔ∏è Coupes (Rhino style)</h3>
        <label>Axe X (Longueur)</label>
        <input type="range" id="clipX" min="-100" max="100" value="100">
        
        <label>Axe Y (Hauteur/BIM)</label>
        <input type="range" id="clipY" min="-100" max="100" value="100">
        
        <label>Axe Z (Largeur)</label>
        <input type="range" id="clipZ" min="-100" max="100" value="100">
    </div>

    <button class="reset-btn" onclick="resetView()">üîÑ R√©initialiser la vue</button>
</div>

<canvas id="myCanvas"></canvas>

<script type="module">
    import {Viewer, GLTFLoaderPlugin, SectionPlanesPlugin} from "https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/xeokit-sdk.es.min.js";

    // 1. Initialisation du Viewer avec Occlusion Ambiante
    const viewer = new Viewer({
        canvasId: "myCanvas",
        transparent: false,
        backgroundColor: [1, 1, 1]
    });

    // Configuration des ombres douces (SSAO)
    viewer.scene.sao.enabled = true;
    viewer.scene.sao.intensity = 0.7;
    viewer.scene.sao.radius = 0.5;

    // 2. Activation des Plugins
    const loader = new GLTFLoaderPlugin(viewer);
    const sections = new SectionPlanesPlugin(viewer);

    // 3. Chargement du fichier projet1.glb
    const model = loader.load({
        id: "myModel",
        src: "./projet1.glb", // Assurez-vous que le fichier est au m√™me niveau que index.html
        edges: true
    });

    model.on("loaded", () => {
        viewer.cameraFlight.jumpTo(model);
        window.setMode('mono'); // Force le mode monochrome au d√©part
    });

    // 4. Logique des Boutons de Rendu
    window.setMode = (mode) => {
        document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        
        if (mode === 'mono') {
            document.getElementById('btnMono').classList.add('active');
            viewer.scene.setObjectsColor(viewer.scene.objectIds, [1, 1, 1]); // Blanc
            viewer.scene.setObjectsXRayed(viewer.scene.objectIds, false);
            viewer.scene.edgeMaterial.edges = true;
            viewer.scene.edgeMaterial.edgeColor = [0.3, 0.3, 0.3]; // Lignes grises
        } 
        else if (mode === 'real') {
            document.getElementById('btnReal').classList.add('active');
            viewer.scene.setObjectsColor(viewer.scene.objectIds, null); // Restaure textures
            viewer.scene.edgeMaterial.edges = false;
        } 
        else if (mode === 'wire') {
            document.getElementById('btnWire').classList.add('active');
            viewer.scene.setObjectsXRayed(viewer.scene.objectIds, true); // Effet transparent
            viewer.scene.edgeMaterial.edges = true;
        }
    };

    // 5. Logique des Coupes
    const pX = sections.createSectionPlane({ id:"pX", pos:[0,0,0], dir:[-1, 0, 0] });
    const pY = sections.createSectionPlane({ id:"pY", pos:[0,0,0], dir:[0, -1, 0] });
    const pZ = sections.createSectionPlane({ id:"pZ", pos:[0,0,0], dir:[0, 0, -1] });

    const setupClip = (id, plane) => {
        document.getElementById(id).oninput = (e) => {
            const val = parseFloat(e.target.value);
            // On multiplie par 0.5 ou plus selon la taille du projet
            plane.pos = [plane.dir[0]*val, plane.dir[1]*val, plane.dir[2]*val];
        };
    };

    setupClip("clipX", pX);
    setupClip("clipY", pY);
    setupClip("clipZ", pZ);

    // 6. R√©initialiser la vue
    window.resetView = () => {
        viewer.cameraFlight.flyTo(model);
        document.getElementById("clipX").value = 100;
        document.getElementById("clipY").value = 100;
        document.getElementById("clipZ").value = 100;
        pX.pos = [100,0,0]; pY.pos = [0,100,0]; pZ.pos = [0,0,100];
    };

</script>
</body>
</html>
